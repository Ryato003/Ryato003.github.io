<!DOCTYPE html>
<html lang="it" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Settimanale App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Stili Base */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Stile per i riquadri dei pasti */
        .meal-box {
             padding: 1rem; /* p-4 */
             border-radius: 0.75rem; /* rounded-lg */
             box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1); /* shadow-sm */
        }
        .dark .meal-box {
             box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.3), 0 1px 1px -1px rgb(0 0 0 / 0.3); /* Ombra pi√π scura */
        }

        .recipe-trigger { cursor: pointer; font-weight: 500; text-decoration: underline dotted; text-underline-offset: 3px; transition: color 0.15s ease-in-out, text-decoration-color 0.15s ease-in-out; }
        .recipe-trigger:hover { text-decoration: underline solid; }


        /* --- Stili Navigation Drawer - Material You Inspired --- */
        #sideNav { position: fixed; top: 0; left: 0; height: 100%; width: 300px; background-color: #FEFBFF; box-shadow: 0 8px 10px -5px rgb(0 0 0 / 0.2), 0 16px 24px 2px rgb(0 0 0 / 0.14), 0 6px 30px 5px rgb(0 0 0 / 0.12); transform: translateX(-100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 40; padding-top: 0; display: flex; flex-direction: column; overflow: hidden; }
        .dark #sideNav { background-color: #1B1C18; }
        #sideNav.open { transform: translateX(0); }
        #navHeader { padding: 1rem 1rem; margin-bottom: 0.5rem; flex-shrink: 0; border-bottom: 1px solid #E0E2D9; }
        .dark #navHeader { border-bottom-color: #454744; }
        #navHeader h2 { font-size: 1.125rem; font-weight: 500; color: #1B1C18; }
        .dark #navHeader h2 { color: #E4E2DE; }
        #navDynamicContent { flex-grow: 1; overflow-y: auto; padding: 0 0.75rem 1rem 0.75rem; }
        #navOverlay { position: fixed; inset: 0; z-index: 30; opacity: 0; transition: opacity 0.3s ease-in-out; pointer-events: none; background-color: rgba(0, 0, 0, 0.5); }
        .dark #navOverlay { background-color: rgba(0, 0, 0, 0.6); }
        #navOverlay.active { opacity: 1; pointer-events: auto; }
        #sideNav details { width: 100%; }
        #navDynamicContent > details:not(:first-child) { border-top: 1px solid #E0E2D9; margin-top: 0.5rem; padding-top: 0.5rem; }
        .dark #navDynamicContent > details:not(:first-child) { border-top-color: #454744; }
        #sideNav details summary.nav-summary { display: flex; align-items: center; position: relative; padding: 0.75rem 0.5rem; font-weight: 500; font-size: 0.9375rem; border-radius: 9999px; margin: 0; cursor: pointer; transition: background-color 0.15s ease-in-out; -webkit-tap-highlight-color: transparent; }
        #sideNav details summary.nav-summary:hover, #sideNav a.nav-link-day:hover { background-color: rgba(27, 28, 24, 0.08); }
        .dark #sideNav details summary.nav-summary:hover, .dark #sideNav a.nav-link-day:hover { background-color: rgba(228, 226, 222, 0.08); }
        #sideNav details summary.nav-summary:active, #sideNav a.nav-link-day:active:not(.active) { background-color: rgba(27, 28, 24, 0.12); }
        .dark #sideNav details summary.nav-summary:active, .dark #sideNav a.nav-link-day:active:not(.active) { background-color: rgba(228, 226, 222, 0.12); }
        #sideNav > details > summary.nav-summary-month { font-weight: 500; padding-top: 0.875rem; padding-bottom: 0.875rem; border-radius: 0; }
        #sideNav > details > summary.nav-summary-month svg { width: 24px; height: 24px; margin-right: 1rem; flex-shrink: 0; }
        /* Classi Colore Mesi */
        .nav-month-gennaio { color: #00668B; } .nav-month-gennaio svg { color: #0EA5E9; } .dark .nav-month-gennaio { color: #7DD3FC; } .dark .nav-month-gennaio svg { color: #38BDF8; }
        .nav-month-febbraio { color: #9D267A; } .nav-month-febbraio svg { color: #E879F9; } .dark .nav-month-febbraio { color: #F0ABFC; } .dark .nav-month-febbraio svg { color: #E879F9; }
        .nav-month-marzo { color: #65A30D; } .nav-month-marzo svg { color: #A3E635; } .dark .nav-month-marzo { color: #BEF264; } .dark .nav-month-marzo svg { color: #A3E635; }
        .nav-month-aprile { color: #0891B2; } .nav-month-aprile svg { color: #22D3EE; } .dark .nav-month-aprile { color: #67E8F9; } .dark .nav-month-aprile svg { color: #22D3EE; }
        .nav-month-maggio { color: #BE185D; } .nav-month-maggio svg { color: #F472B6; } .dark .nav-month-maggio { color: #F9A8D4; } .dark .nav-month-maggio svg { color: #F472B6; }
        .nav-month-giugno { color: #D97706; } .nav-month-giugno svg { color: #FBBF24; } .dark .nav-month-giugno { color: #FCD34D; } .dark .nav-month-giugno svg { color: #FBBF24; }
        .nav-month-luglio { color: #2563EB; } .nav-month-luglio svg { color: #60A5FA; } .dark .nav-month-luglio { color: #93C5FD; } .dark .nav-month-luglio svg { color: #60A5FA; }
        .nav-month-agosto { color: #EA580C; } .nav-month-agosto svg { color: #FB923C; } .dark .nav-month-agosto { color: #FDBA74; } .dark .nav-month-agosto svg { color: #FB923C; }
        .nav-month-settembre { color: #CA8A04; } .nav-month-settembre svg { color: #FACC15; } .dark .nav-month-settembre { color: #FDE047; } .dark .nav-month-settembre svg { color: #FACC15; }
        .nav-month-ottobre { color: #DC2626; } .nav-month-ottobre svg { color: #F87171; } .dark .nav-month-ottobre { color: #FCA5A5; } .dark .nav-month-ottobre svg { color: #F87171; }
        .nav-month-novembre { color: #78350F; } .nav-month-novembre svg { color: #D97706; } .dark .nav-month-novembre { color: #FCD34D; } .dark .nav-month-novembre svg { color: #FBBF24; }
        .nav-month-dicembre { color: #047857; } .nav-month-dicembre svg { color: #34D399; } .dark .nav-month-dicembre { color: #6EE7B7; } .dark .nav-month-dicembre svg { color: #34D399; }
        /* Fine Classi Colore Mesi */
        #sideNav details details summary.nav-summary { padding-left: 2.5rem; font-size: 0.875rem; color: #454744; }
        .dark #sideNav details details summary.nav-summary { color: #C8C6C1; }
        #sideNav a.nav-link-day { display: block; position: relative; padding: 0.75rem 0.5rem 0.75rem 3.5rem; font-size: 0.875rem; font-weight: 400; color: #454744; border-radius: 9999px; margin: 0.125rem 0; transition: background-color 0.15s ease-in-out, color 0.15s ease-in-out, font-weight 0.15s ease-in-out; text-decoration: none; overflow: hidden; }
        .dark #sideNav a.nav-link-day { color: #C8C6C1; }
        #sideNav a.nav-link-day.active { font-weight: 500; color: #001D36; background-color: #D0E4FF; }
        .dark #sideNav a.nav-link-day.active { color: #D0E4FF; background-color: #004A77; }
        #sideNav details > summary.nav-summary::after { content: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="%23757873" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>'); display: inline-block; width: 20px; height: 20px; margin-left: auto; transition: transform 0.2s ease-in-out; flex-shrink: 0; }
        .dark #sideNav details > summary.nav-summary::after { content: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="%238F918B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>'); }
        #sideNav details[open] > summary.nav-summary::after { transform: rotate(180deg); }

        /* Stili Modal Procedimento */
        #procedureModal {
            position: fixed; inset: 0; display: flex; /* Usa flex per centrare */
            align-items: center; justify-content: center; z-index: 50;
            opacity: 0; /* Inizia invisibile */
            transition: opacity 0.2s ease-in-out;
            pointer-events: none; /* Non interagibile quando invisibile */
            padding: 1rem; background-color: rgba(0, 0, 0, 0.6);
        }
        .dark #procedureModal { background-color: rgba(0, 0, 0, 0.7); }
        #procedureModal.active {
            opacity: 1; /* Rendi visibile */
            pointer-events: auto; /* Rendi interagibile */
        }
        .modal-content {
            padding: 1.75rem; border-radius: 1rem;
            box-shadow: 0 24px 38px 3px rgb(0 0 0 / 0.14), 0 9px 46px 8px rgb(0 0 0 / 0.12), 0 11px 15px -7px rgb(0 0 0 / 0.2);
            max-width: 95%; width: 500px; max-height: 85vh; overflow-y: auto; position: relative;
            transition: background-color 0.3s ease, transform 0.2s ease-out;
            transform: scale(0.95); /* Inizia leggermente rimpicciolito */
            background-color: #fff; /* Sfondo di default */
        }
        .dark .modal-content { background-color: #1f2937; } /* Sfondo dark mode */
        #procedureModal.active .modal-content {
            transform: scale(1); /* Scala alla dimensione normale quando attivo */
        }
        .modal-close-btn { position: absolute; top: 0.75rem; right: 0.75rem; background: none; border: none; cursor: pointer; padding: 0.5rem; line-height: 1; z-index: 10; border-radius: 9999px; transition: background-color 0.15s ease-in-out, transform 0.1s ease-in-out, color 0.15s ease-in-out; }
        .modal-close-btn:hover { transform: scale(1.1); }
        .modal-close-btn:active { transform: scale(1); }
        .modal-close-btn svg { display: block; width: 20px; height: 20px; }
        #modalProcedureText ol { list-style: decimal; margin-left: 1.5rem; }
        #modalProcedureText li { padding-left: 0.5rem; margin-bottom: 0.625rem; line-height: 1.6; }
        #modalProcedureText li::marker { font-weight: 500; }

        /* Header sticky (Invariato) */
        header { transition: background-color 0.3s ease, border-color 0.3s ease; }
        /* .hidden-view { display: none; } */ /* Non pi√π usato per la modale */
        .main-container { max-width: 896px; margin-left: auto; margin-right: auto; padding: 1rem; }
        @media (min-width: 640px) { .main-container { padding: 1.5rem; } }
        @media (min-width: 1024px) { .main-container { padding: 2rem; } }

        /* Stile per il messaggio placeholder */
        #menu-placeholder { text-align: center; padding: 4rem 1rem; font-size: 1.125rem; color: #757873; }
        .dark #menu-placeholder { color: #8F918B; }

        /* Stile per titolo menu dinamico */
        .menu-title { text-xl sm:text-2xl font-semibold text-slate-700 dark:text-slate-200 mb-6 flex items-center; }
        .menu-title svg { lucide lucide-calendar-check-2 mr-2 text-indigo-600 dark:text-indigo-400 h-6 w-6 sm:h-7 sm:w-7; }

    </style>
</head>
<body class="bg-slate-100 dark:bg-slate-900 text-slate-900 dark:text-slate-200">
    <header class="bg-white dark:bg-slate-800 shadow-sm sticky top-0 z-20 border-b border-slate-200 dark:border-slate-700">
        <div class="container mx-auto max-w-4xl px-4 h-16 flex items-center">
            <button id="menuBtn" class="p-2 mr-3 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 dark:ring-offset-slate-800 transition-colors duration-150">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu h-6 w-6 text-slate-700 dark:text-slate-300"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
            </button>
            <h1 class="text-xl font-semibold text-slate-800 dark:text-slate-100">Menu Settimanale</h1>
        </div>
    </header>

    <nav id="sideNav">
        <div id="navHeader"><h2>Navigazione Menu</h2></div>
        <div id="navDynamicContent"></div>
    </nav>

    <div id="navOverlay"></div>

    <div class="main-container mt-4">
        <div id="menu-view">
            <section id="menu" class="mb-12">
                <div id="menu-placeholder">
                    Seleziona una data dal menu laterale.
                </div>
            </section>
        </div>
    </div>

    <div id="procedureModal">
        <div id="modalContentDiv" class="modal-content relative"> <button id="closeModalBtn" class="modal-close-btn text-slate-500 hover:bg-slate-100 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-100 dark:hover:bg-white/10" aria-label="Chiudi modale">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            </button>
            <h3 id="modalTitle" class="text-lg font-semibold mb-4 text-slate-900 dark:text-slate-100">Procedimento</h3>
            <div id="modalProcedureText" class="text-sm text-slate-700 dark:text-slate-300"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOMContentLoaded fired.");

            // --- Selezione Elementi DOM ---
            const menuBtn = document.getElementById('menuBtn');
            const sideNav = document.getElementById('sideNav');
            const navOverlay = document.getElementById('navOverlay');
            const navDynamicContent = document.getElementById('navDynamicContent');
            const body = document.body;
            const menuView = document.getElementById('menu-view');
            const menuSection = document.getElementById('menu');
            const procedureModal = document.getElementById('procedureModal');
            const modalContentDiv = document.getElementById('modalContentDiv');
            const modalTitle = document.getElementById('modalTitle');
            const modalProcedureText = document.getElementById('modalProcedureText');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const mainContainer = document.querySelector('.main-container');

            // --- Dati Menu (Esempio Aprile - Settimana 2 con Ricette Aggiornate da Ricerca Online) ---
            // (menuData rimane invariato rispetto alla versione precedente)
            const menuData = {
                "Aprile": {
                    "2": { // Settimana 2
                        "Luned√¨": {
                            meals: [
                                { type: 'Colazione', icon: 'ü•õ', text: '300ml Latte parzialmente scremato con 90g Biscotti secchi/ai cereali.', recipe: null },
                                { type: 'Pranzo', icon: 'üçù', text: '150g Pasta integrale al pesto leggero di rucola con 150g Petto di pollo grigliato. Contorno abbondante di pomodori e insalata mista.',
                                  recipeTriggerText: 'al pesto leggero di rucola',
                                  // Ricetta AGGIORNATA da Fine Dining Lovers
                                  recipe: {
                                    title: 'Pesto Leggero di Rucola (Fonte: Fine Dining Lovers)',
                                    procedure: "Versare la rucola (100g), i pinoli o noci (50g), l'aglio (1 spicchio), Parmigiano (50g), Pecorino (50g) e olio EVO (100ml) in un mixer.|Aggiungere sale e pepe.|Frullare fino ad ottenere un composto liscio e cremoso. (Per versione pi√π leggera, ridurre formaggio/olio o usare solo noci)."
                                    }
                                },
                                { type: 'Spuntino', icon: 'üçé', text: '1 Mela + 170g Yogurt greco + 40g Gallette di riso/mais.', recipe: null },
                                { type: 'Cena', icon: 'üêü', text: "200g Orata (o Merluzzo) all'acqua pazza, 300g Patate lesse o al vapore, asparagi al vapore.",
                                  recipeTriggerText: "all'acqua pazza",
                                  // Ricetta AGGIORNATA da Cookist
                                  recipe: {
                                    title: "Orata all'Acqua Pazza (Fonte: Cookist)",
                                    procedure: "Lasciare imbiondire aglio (2 spicchi) in olio EVO in un tegame.|Versare pomodorini (400g) tagliati a met√†, sale e pepe.|Disporre il pesce (2 orate) sui pomodori e far insaporire.|Sfumare con vino bianco (140ml).|Cuocere per circa 20 minuti, rigirando a met√† cottura.|Servire con prezzemolo tritato."
                                    }
                                },
                                { type: 'Spuntino pre nanna', icon: 'üåô', text: "150g Fiocchi di latte + 10g Burro d'arachidi + 30g Gallette di riso/mais.", recipe: null }
                            ]
                        },
                        "Marted√¨": {
                             meals: [
                                 { type: 'Colazione', icon: 'ü•õ', text: '300ml Latte p.s. con 90g Biscotti secchi/ai cereali.', recipe: null },
                                 { type: 'Pranzo', icon: 'üçö', text: '150g Riso e Lenticchie. Contorno di carote crude + 100g Ricottine.',
                                   recipeTriggerText: 'Riso e Lenticchie',
                                   // Ricetta ORIGINALE (Non trovata online con dosi precise nella ricerca)
                                   recipe: { title: 'Riso e Lenticchie', procedure: "1. Prepara un soffritto con circa 40g di cipolla tritata e 1 cucchiaino (5ml) di olio EVO.|2. Aggiungi 150g di lenticchie (gi√† cotte o sciacquate se in scatola).|3. Aggiungi 150g di riso Basmati e tostalo leggermente per un minuto.|4. Copri con brodo vegetale caldo (circa 350-400ml).|5. Porta a cottura (circa 15-18 min) mescolando di tanto in tanto e aggiungendo altro brodo caldo se necessario.|6. Aggiusta di sale e aggiungi 1 rametto di rosmarino tritato a fine cottura." }
                                 },
                                 { type: 'Spuntino', icon: 'ü•ú', text: '1 Pera + 30g Frutta secca + 40g Gallette di riso/mais.', recipe: null },
                                 { type: 'Cena', icon: 'ü¶É', text: '200g Petto di tacchino saltato con funghi e cipolla, 130g Farro perlato, insalata mista.',
                                   recipeTriggerText: 'Petto di tacchino saltato con funghi',
                                   // Ricetta AGGIORNATA (Adattata da Ricettario Bimby)
                                   recipe: {
                                     title: 'Petto di tacchino saltato con funghi (Adatt. da Ricettario Bimby)',
                                     procedure: "Soffriggere aglio (1 spicchio) e prezzemolo in olio.|Aggiungere funghi (250g champignon + 250g misti) puliti e tagliati, sale/dado. Cuocere 10-15 min.|Tagliare petto di tacchino (3 fette) a strisce e infarinarlo.|Aggiungere il tacchino ai funghi.|Aggiungere latte (100-150ml) e sale/dado.|Cuocere per circa 10 min finch√© cotto e cremoso.|Servire con prezzemolo fresco." }
                                 },
                                 { type: 'Spuntino pre nanna', icon: 'üåô', text: '1 misurino (30g) Proteine in polvere sciolte in 200ml acqua o Latte + 20g Frutta secca.', recipe: null }
                             ]
                        },
                         "Mercoled√¨": {
                             meals: [
                                 { type: 'Colazione', icon: 'ü•õ', text: '300ml Latte p.s. con 90g Biscotti secchi/ai cereali.', recipe: null },
                                 { type: 'Pranzo', icon: 'üêî', text: '180g Petto di pollo alla pizzaiola. Accompagnare con 100g Pane integrale e verdure grigliate (melanzane/zucchine).',
                                   recipeTriggerText: 'alla pizzaiola',
                                   // Ricetta AGGIORNATA da Casa Pappagallo
                                   recipe: {
                                     title: 'Petto di Pollo alla Pizzaiola (Fonte: Casa Pappagallo)',
                                     procedure: "Rosolare fette di pollo (es. 180g) in olio e salare. Togliere dalla padella.|Nella stessa padella, aggiungere olio, pomodori pelati frullati (es. 150g), aglio (1 spicchio), capperi (pochi), origano. Cuocere 4-5 min, salare.|Aggiungere olive (poche). Rimettere il pollo nel sugo.|Aggiungere mozzarella (es. 40g) a pezzi sopra.|Coprire e cuocere a fuoco basso finch√© sciolta, o gratinare in forno." }
                                 },
                                 { type: 'Spuntino', icon: 'üçì', text: '1 Banana + 100g Ricottine con Cacao amaro.', recipe: null },
                                 { type: 'Cena', icon: 'ü•©', text: 'Polpette leggere al sugo con 130g Orzo perlato e spinaci saltati con aglio.',
                                   recipeTriggerText: 'Polpette leggere al sugo',
                                   // Ricetta ORIGINALE (Non trovata online con dosi precise nella ricerca)
                                   recipe: { title: 'Polpette Leggere al Sugo', procedure: "1. Impasta 180g di macinato magro con 15g di pane grattugiato, 30g di albume, 1 cucchiaio di prezzemolo tritato, sale e pepe.|2. Forma delle polpette non troppo grandi.|3. Prepara un sugo semplice soffriggendo 40g di cipolla tritata (o aglio) in 1 cucchiaino (5ml) di olio, aggiungendo pomodori pelati (circa 250g) e sale.|4. Adagia delicatamente le polpette nel sugo caldo.|5. Copri e cuoci a fuoco basso per almeno 20-25 minuti, girandole a met√† cottura." }
                                 },
                                 { type: 'Spuntino pre nanna', icon: 'üåô', text: '170g Yogurt greco + 40g Gallette di riso/mais + Miele (se gradito).', recipe: null }
                             ]
                         },
                         "Gioved√¨": {
                             meals: [
                                 { type: 'Colazione', icon: 'ü•õ', text: '300ml Latte p.s. con 90g Biscotti secchi/ai cereali.', recipe: null },
                                 { type: 'Pranzo', icon: 'ü¶ê', text: '150g Riso integrale saltato con 150g Gamberetti e zucchine. Contorno di carote crude + 100g Formaggio spalmabile proteico.',
                                   recipeTriggerText: 'saltato con 150g Gamberetti e zucchine',
                                   // Ricetta ORIGINALE (Non trovata online con dosi precise nella ricerca)
                                   recipe: { title: 'Riso saltato con Gamberetti e Zucchine', procedure: "1. Cuoci 150g di riso integrale.|2. Pulisci 150g di gamberetti.|3. Taglia una zucchina a julienne o piccoli cubetti.|4. Salta 1 spicchio d'aglio in 1-2 cucchiaini (5-10ml) di olio EVO.|5. Aggiungi i gamberetti e cuoci per 2-3 minuti finch√© cambiano colore.|6. Aggiungi le zucchine, sale, pepe, succo di limone e 1 cucchiaio di prezzemolo tritato.|7. Salta per un altro minuto, le zucchine devono rimanere croccanti.|8. Unisci il riso cotto e manteca bene." }
                                 },
                                 { type: 'Spuntino', icon: 'üçä', text: '1 Pera + 170g Yogurt greco + 30g Gallette di riso/mais.', recipe: null },
                                 { type: 'Cena', icon: 'üçó', text: '200g Pollo arrosto con rosmarino, 300g Patate al forno, zucchine grigliate.',
                                   recipeTriggerText: 'Pollo arrosto con rosmarino',
                                   // Ricetta ORIGINALE (Non trovata online versione semplice con dosi precise nella ricerca)
                                   recipe: { title: 'Pollo Arrosto con Rosmarino', procedure: "1. Prendi 200g di pollo (cosce senza pelle o petto).|2. Condiscilo con 1-2 cucchiaini (5-10ml) di Olio EVO, sale, pepe e 1-2 rametti di rosmarino tritato (e/o 1 spicchio d'aglio se gradito).|3. Disponilo su una teglia insieme a 300g di patate tagliate a spicchi e condite.|4. Cuoci in forno preriscaldato a 190-200¬∞C per circa 30-45 minuti (a seconda della dimensione dei pezzi), finch√© il pollo √® cotto e le patate sono tenere e dorate." }
                                 },
                                 { type: 'Spuntino pre nanna', icon: 'üåô', text: '150g Fiocchi di latte + 30g Frutta secca.', recipe: null }
                             ]
                         },
                         "Venerd√¨": {
                             meals: [
                                 { type: 'Colazione', icon: 'ü•õ', text: '300ml Latte p.s. con 90g Biscotti secchi/ai cereali.', recipe: null },
                                 { type: 'Pranzo', icon: 'üç≤', text: 'Pasta e Lenticchie (100g pasta mista/ditalini). Servire con 50g Pane integrale.',
                                   recipeTriggerText: 'Pasta e Lenticchie',
                                   // Ricetta AGGIORNATA da Cookist (via TikTok)
                                   recipe: {
                                     title: 'Pasta e Lenticchie (Fonte: Cookist/TikTok)',
                                     procedure: "Sciacquare lenticchie secche (es. 60g per porzione) e cuocerle in acqua finch√© tenere.|In altra pentola, rosolare aglio (1 spicchio) in olio (1/2 cucchiaio).|Aggiungere pomodorini (1-2) tagliati e insaporire.|Scolare le lenticchie e aggiungerle ai pomodori, aggiungere acqua/brodo.|Portare a bollore, aggiungere pasta (es. 60g tubetti) e cuocere nel sugo.|Aggiustare di sale, aggiungere prezzemolo tritato. Riposare prima di servire." }
                                 },
                                 { type: 'Spuntino', icon: 'üçä', text: '1 Banana + 170g Yogurt greco + 30g Gallette di riso/mais.', recipe: null },
                                 { type: 'Cena', icon: 'üç≥', text: 'Frittata al forno con spinaci e 50g Ricotta. Contorno di insalata mista e 100g Pane integrale.',
                                   recipeTriggerText: 'Frittata al forno con spinaci e 50g Ricotta',
                                   // Ricetta AGGIORNATA da GnamGnam.it
                                   recipe: {
                                     title: 'Frittata Forno Spinaci e Ricotta (Fonte: GnamGnam.it)',
                                     procedure: "Cuocere spinaci (es. 100g surgelati), strizzarli e sminuzzarli.|Lavorare ricotta (50g) con forchetta.|Aggiungere uova (1), mescolare.|Aggiungere spinaci, parmigiano (20g), sale, pepe. Mescolare.|Versare in teglia piccola unta/con carta forno.|Cuocere a 180¬∞C ventilato per 20-25 min." }
                                 },
                                 { type: 'Spuntino pre nanna', icon: 'üåô', text: "1 misurino (30g) Proteine in polvere + 10g Burro d'arachidi.", recipe: null }
                             ]
                         },
                         "Sabato": {
                             meals: [
                                 { type: 'Colazione', icon: 'ü•õ', text: '300ml Latte p.s. con 90g Biscotti secchi/ai cereali.', recipe: null },
                                 { type: 'Pranzo', icon: 'üçï', text: 'Pizza Margherita o con verdure (fatta in casa o da asporto).', recipe: null }, // Nessuna ricetta specifica trovata/inserita
                                 { type: 'Spuntino', icon: 'üçå', text: '1 Pera + 150g Fiocchi di latte + 30g Gallette di riso/mais.', recipe: null },
                                 { type: 'Cena', icon: 'üç£', text: '180g Salmone alla griglia, 130g Riso Basmati, spinaci saltati con aglio e Olio EVO.',
                                   recipeTriggerText: 'Salmone alla griglia',
                                    // Ricetta ORIGINALE (Non trovata online con dosi precise nella ricerca)
                                   recipe: { title: 'Salmone Grigliato', procedure: "1. Scalda bene una griglia o una padella antiaderente.|2. Condisci 180g di filetto di salmone con sale, pepe, succo di limone e 1 cucchiaio di prezzemolo tritato (o aneto).|3. Cuoci sulla griglia calda per 3-5 minuti per lato (a seconda dello spessore e della cottura desiderata), iniziando dal lato della pelle se presente." }
                                 },
                                 { type: 'Spuntino pre nanna', icon: 'üåô', text: '170g Yogurt greco + 20g Frutta secca.', recipe: null }
                             ]
                         },
                         "Domenica": {
                             meals: [
                                 { type: 'Colazione', icon: 'ü•õ', text: '300ml Latte p.s. con 90g Biscotti secchi/ai cereali.', recipe: null },
                                 { type: 'Pranzo', icon: 'üçù', text: '150g Pasta integrale al rag√π leggero. Contorno di insalata.',
                                   recipeTriggerText: 'al rag√π leggero',
                                   // Ricetta ORIGINALE (Non trovata online con dosi precise nella ricerca)
                                   recipe: { title: 'Rag√π Leggero', procedure: "1. Prepara un soffritto con 30g sedano, 30g carota, 40g cipolla tritati finemente e 1-2 cucchiaini (5-10ml) di olio EVO.|2. Aggiungi 150g di macinato magro (manzo o misto) e fallo rosolare bene sgranandolo.|3. Sfuma con 50ml di vino bianco o rosso (facoltativo) e lascia evaporare.|4. Aggiungi pomodori pelati (circa 300g) o passata, sale, pepe e una foglia d'alloro (facoltativo).|5. Copri e lascia sobbollire a fuoco basso per almeno 30-40 minuti, aggiungendo poca acqua calda o brodo q.b. se si asciuga troppo." }
                                 },
                                 { type: 'Spuntino', icon: 'üçê', text: '1 Mela + 100g Ricottine + 40g Gallette di riso/mais.', recipe: null },
                                 { type: 'Cena', icon: 'üçó', text: '200g Petto di pollo arrosto con erbe, 300g Patate al forno, melanzane al forno.',
                                   recipeTriggerText: 'Petto di pollo arrosto con erbe',
                                   // Ricetta AGGIORNATA da Cooker Girl (Nota: Elaborata e per pollo intero)
                                   recipe: {
                                     title: 'Pollo Arrosto alle Erbe (Fonte: Cooker Girl - Elaborata)',
                                     procedure: "Creare farcia: frullare lardo(70g), burro(100g), erbe aromatiche abbondanti, aglio(1), scorza limone(1), senape(1 cucchiaino), sale, pepe.|Inserire parte della farcia sotto la pelle del petto (di un pollo intero).|Legare il pollo.|Cuocere su gratella sopra teglia con erbe/aglio/limone/olio.|Massaggiare esterno con altra farcia.|Forno statico: 220¬∞C(10min) -> 200¬∞C(10min) -> 160¬∞C (1h/kg).|Irrorare a met√† cottura. Temp. interna coscia ~72¬∞C.|Riposare 20 min. (Nota: ricetta per pollo intero, molto ricca)." }
                                 },
                                 { type: 'Spuntino pre nanna', icon: 'üåô', text: "1 misurino (30g) Proteine sciolte in 200ml acqua o Latte + 10g Burro d'arachidi.", recipe: null }
                             ]
                         }
                    }
                }
            };


            // --- Dati Navigazione ---
            const mesi = ["Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno", "Luglio", "Agosto", "Settembre", "Ottobre", "Novembre", "Dicembre"];
            const giorni = ["Luned√¨", "Marted√¨", "Mercoled√¨", "Gioved√¨", "Venerd√¨", "Sabato", "Domenica"];
            const settimanePerMese = 4;

            // --- Placeholder Messages ---
            const placeholderTextDefault = "Seleziona una data dal menu laterale.";
            const placeholderTextNotAvailable = "Menu non disponibile per questa data. Seleziona un giorno nella Settimana 2 di Aprile per visualizzare l'esempio.";

            // --- Funzione per mostrare il placeholder ---
            function showPlaceholder(message = placeholderTextDefault) {
                 if (!menuSection) return;
                 const oldTitle = menuSection.querySelector('.menu-title');
                 if(oldTitle) oldTitle.remove();
                 menuSection.innerHTML = `<div id="menu-placeholder">${message}</div>`;
            }

            // --- Funzione per renderizzare i pasti di un giorno ---
            function renderDayMenu(dayData) {
                 if (!dayData || !dayData.meals) return null;

                 const mealsContainer = document.createElement('div');
                 mealsContainer.className = 'space-y-4';

                 dayData.meals.forEach(meal => {
                     const mealBox = document.createElement('div');
                     mealBox.className = 'meal-box';

                     let mealColorClass = 'bg-gray-50 dark:bg-slate-700';
                     if (meal.type === 'Colazione') mealColorClass = 'bg-blue-50 dark:bg-slate-700/80';
                     else if (meal.type === 'Pranzo') mealColorClass = 'bg-green-50 dark:bg-slate-700/80';
                     else if (meal.type === 'Spuntino') mealColorClass = 'bg-yellow-50 dark:bg-slate-700/80';
                     else if (meal.type === 'Cena') mealColorClass = 'bg-red-50 dark:bg-slate-700/80';
                     else if (meal.type === 'Spuntino pre nanna') mealColorClass = 'bg-purple-50 dark:bg-slate-700/80';
                     mealBox.classList.add(...mealColorClass.split(' '));

                     // Costruisce HTML base
                     let mealHTML = `<div class="text-sm"><strong class="block mb-1">${meal.icon || ''} ${meal.type}:</strong> ${meal.text}</div>`;

                     // Se c'√® una ricetta e un testo trigger specificato, sostituisci il testo trigger
                     if (meal.recipe && meal.recipe.title && meal.recipeTriggerText) {
                         const triggerSpan = `<span class="recipe-trigger text-blue-600 dark:text-indigo-400 hover:text-blue-700 dark:hover:text-indigo-300" data-title="${meal.recipe.title}" data-procedure="${meal.recipe.procedure || ''}">${meal.recipeTriggerText}</span>`;
                         // Sostituisce solo la prima occorrenza del testo trigger
                         mealHTML = mealHTML.replace(meal.recipeTriggerText, triggerSpan);
                     }

                     mealBox.innerHTML = mealHTML;
                     mealsContainer.appendChild(mealBox);
                 });

                 return mealsContainer;
            }


            // --- Funzione per Generare la Navigazione Dinamica ---
            function generaNavigazione() {
                 if (!navDynamicContent) { console.error("Elemento #navDynamicContent non trovato!"); return; }
                 navDynamicContent.innerHTML = '';
                 const calendarIconSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-days"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg>`;
                 mesi.forEach(nomeMese => {
                     const meseDetails = document.createElement('details');
                     const meseSummary = document.createElement('summary');
                     const monthClass = 'nav-month-' + nomeMese.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                     meseSummary.classList.add('nav-summary', 'nav-summary-month', monthClass);
                     meseSummary.innerHTML = `${calendarIconSvg} ${nomeMese}`;
                     const settimaneContainer = document.createElement('div');
                     for (let i = 1; i <= settimanePerMese; i++) {
                         const settimanaDetails = document.createElement('details');
                         const settimanaSummary = document.createElement('summary');
                         settimanaSummary.classList.add('nav-summary');
                         settimanaSummary.textContent = `Settimana ${i}`;
                         const giorniContainer = document.createElement('div');
                         giorni.forEach(nomeGiorno => {
                             const giornoLink = document.createElement('a');
                             giornoLink.href = '#';
                             giornoLink.classList.add('nav-link-day');
                             giornoLink.dataset.giorno = nomeGiorno;
                             giornoLink.dataset.settimana = String(i);
                             giornoLink.dataset.mese = nomeMese;
                             giornoLink.textContent = nomeGiorno;
                             giorniContainer.appendChild(giornoLink);
                         });
                         settimanaDetails.appendChild(settimanaSummary);
                         settimanaDetails.appendChild(giorniContainer);
                         settimaneContainer.appendChild(settimanaDetails);
                     }
                     meseDetails.appendChild(meseSummary);
                     meseDetails.appendChild(settimaneContainer);
                     navDynamicContent.appendChild(meseDetails);
                 });
                  console.log("Navigazione Material You con colori generata.");
            }

            // --- Genera la navigazione e mostra placeholder iniziale ---
            generaNavigazione();
            showPlaceholder();

            // --- Logica Apertura/Chiusura Navigazione Laterale ---
            function openNav() { sideNav.classList.add('open'); navOverlay.classList.add('active'); body.style.overflow = 'hidden'; }
            function closeNav() { sideNav.classList.remove('open'); navOverlay.classList.remove('active'); body.style.overflow = ''; }

            if (menuBtn) { menuBtn.addEventListener('click', (e) => { e.stopPropagation(); openNav(); }); }
            if (navOverlay) { navOverlay.addEventListener('click', closeNav); }

            // --- Gestione Click su Giorni Nav e Caricamento Contenuto ---
            if (sideNav) {
                sideNav.addEventListener('click', (e) => {
                    const linkCliccato = e.target.closest('a.nav-link-day');
                    if (linkCliccato) {
                        e.preventDefault();

                        const meseSelezionato = linkCliccato.dataset.mese;
                        const settimanaSelezionata = linkCliccato.dataset.settimana;
                        const giornoSelezionato = linkCliccato.dataset.giorno;

                        console.log(`Day link clicked: ${giornoSelezionato}, Sett ${settimanaSelezionata}, ${meseSelezionato}`);

                        const activeLinks = sideNav.querySelectorAll('a.nav-link-day.active');
                        activeLinks.forEach(link => link.classList.remove('active'));
                        linkCliccato.classList.add('active');

                        if (menuSection) {
                            menuSection.innerHTML = ''; // Pulisce

                            const dayData = menuData[meseSelezionato]?.[settimanaSelezionata]?.[giornoSelezionato];

                            if (dayData) {
                                const titleElement = document.createElement('h2');
                                titleElement.className = 'menu-title text-xl sm:text-2xl font-semibold text-slate-700 dark:text-slate-200 mb-6 flex items-center';
                                titleElement.innerHTML = `
                                    <svg class="lucide lucide-calendar-check-2 mr-2 text-indigo-600 dark:text-indigo-400 h-6 w-6 sm:h-7 sm:w-7" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 14V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/><path d="m16 20 2 2 4-4"/></svg>
                                    <span>Piano per ${giornoSelezionato}, Sett. ${settimanaSelezionata}, ${meseSelezionato}</span>`;
                                menuSection.appendChild(titleElement);

                                const mealsContainerElement = renderDayMenu(dayData);
                                if (mealsContainerElement) {
                                    menuSection.appendChild(mealsContainerElement);
                                    console.log(`Menu per ${giornoSelezionato} caricato.`);
                                } else {
                                     showPlaceholder(placeholderTextNotAvailable);
                                }
                            } else {
                                 showPlaceholder(placeholderTextNotAvailable);
                                 console.log("Menu non disponibile per la data selezionata.");
                            }
                        } else {
                            console.error("Elemento #menu non trovato!");
                        }
                        closeNav();
                    }
                });
            }

            // --- Logica Modale Ricette (CORRETTA) ---
             function getModalStyling(triggerElement) {
                  // Questa funzione pu√≤ essere usata per stili pi√π dinamici in futuro,
                  // ma per ora usiamo gli stili CSS fissi per light/dark mode.
                  let modalBgClass = ''; // Non pi√π necessario impostare qui
                  let modalTextClass = ''; // Non pi√π necessario impostare qui
                  let closeBtnClasses = ['text-slate-500', 'hover:bg-slate-100', 'hover:text-slate-700', 'dark:text-slate-400', 'dark:hover:text-slate-100', 'dark:hover:bg-white/10'];
                  let markerColorClass = 'marker:text-slate-500 dark:marker:text-slate-400';
                  return { modalBgClass, modalTextClass, closeBtnClasses, markerColorClass };
             }
             // removeAllColorClasses non √® pi√π strettamente necessaria se gli stili sono fissi nel CSS
             // function removeAllColorClasses(element) { ... }

             function openModal(title, procedure, styles) {
                   if (!modalTitle || !modalProcedureText || !modalContentDiv || !closeModalBtn || !procedureModal) {
                       console.error("Modal elements not found!"); return;
                   }
                  modalTitle.textContent = title || 'Procedimento';
                  const steps = procedure ? procedure.split('|') : [];
                  let procedureHtml = `<p class="text-slate-700 dark:text-slate-300">Procedimento non disponibile.</p>`; // Messaggio default se procedura vuota
                  if (steps.length > 0 && steps[0].trim() !== '') {
                       // Aggiunte classi di testo direttamente agli elementi li/ol
                       procedureHtml = `<ol class="text-slate-700 dark:text-slate-300 ${styles.markerColorClass}">`;
                       steps.forEach(step => { procedureHtml += `<li>${step.trim()}</li>`; });
                       procedureHtml += '</ol>';
                  }
                  modalProcedureText.innerHTML = procedureHtml;

                  // Applica stili rimanenti (es. bottone chiusura) se necessario
                  // removeAllColorClasses(closeModalBtn); // Probabilmente non serve
                  // closeModalBtn.classList.add(...styles.closeBtnClasses); // Gi√† impostato nell'HTML

                  // Rendi visibile la modale aggiungendo la classe 'active'
                  procedureModal.classList.add('active');
                  body.style.overflow = 'hidden'; // Blocca lo scroll del body
             }

             function closeModal() {
                   if (!procedureModal) return;
                   // Nascondi la modale rimuovendo la classe 'active'
                   procedureModal.classList.remove('active');
                   // Ripristina lo scroll del body dopo la fine della transizione CSS (200ms)
                   // Non serve pi√π aggiungere/rimuovere 'hidden'
                   setTimeout(() => {
                       body.style.overflow = '';
                   }, 200); // Deve corrispondere alla durata della transizione CSS
             }

             // Listener delegato su mainContainer per i trigger delle ricette
             if (mainContainer) {
                 mainContainer.addEventListener('click', function(event) {
                     const trigger = event.target.closest('.recipe-trigger');
                     if (trigger) {
                         event.preventDefault();
                         const title = trigger.dataset.title;
                         const procedure = trigger.dataset.procedure;
                         const styles = getModalStyling(trigger); // Ottiene classi stile (anche se meno usate ora)
                         console.log("Opening modal with title:", title); // Log per debug
                         openModal(title, procedure, styles);
                     }
                 });
             } else {
                   console.error("Main container not found for recipe trigger delegation.");
             }

             // Listener chiusura modale
             if (closeModalBtn) { closeModalBtn.addEventListener('click', closeModal); }
             if (procedureModal) {
                  // Chiudi se si clicca sullo sfondo scuro (l'overlay della modale stessa)
                  procedureModal.addEventListener('click', function(event) {
                      if (event.target === procedureModal) {
                          closeModal();
                      }
                  });
                  // Chiudi se si preme il tasto Escape
                  document.addEventListener('keydown', function(event) {
                      if (event.key === 'Escape' && procedureModal.classList.contains('active')) {
                          closeModal();
                      }
                  });
             }

            console.log("DOMContentLoaded finished.");
        });
    </script>

</body>
</html>
