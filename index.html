<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Settimanale App - Spesa Espandibile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Stili Base e Material Inspired (Invariati) */
        body {
            background-color: #f7f9fc;
            font-family: 'Inter', sans-serif;
        }

        .material-card {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            margin-bottom: 1rem;
            overflow: hidden;
        }
        .material-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.25rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.15s ease-in-out;
        }
        .material-summary:hover {
            background-color: rgba(0, 0, 0, 0.04);
        }
         details[open] > .material-summary {
            border-bottom: 1px solid #e5e7eb;
        }
        .material-summary::marker {
            content: "";
        }
        /* Icona '+' per stato chiuso */
        .material-summary::after {
            content: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>');
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-left: 10px;
            transition: transform 0.2s ease-in-out;
            flex-shrink: 0;
            color: inherit; /* Eredita colore testo */
        }
        /* Icona '-' per stato aperto */
        details[open] > .material-summary::after {
            content: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line></svg>');
        }
        /* Stile per le icone dentro il summary della spesa */
        .material-summary svg.category-icon {
             width: 20px;
             height: 20px;
             margin-right: 0.75rem; /* Spazio tra icona e testo */
             flex-shrink: 0;
        }
        .meal-item { /* Stile per i pasti nel menu */
            padding: 0.75rem 1.25rem;
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
            transition: background-color 0.2s ease-in-out;
        }
         .meal-item:last-child {
            margin-bottom: 0;
        }
        .recipe-trigger { /* Stile per link ricette */
            cursor: pointer;
            color: #2563eb;
            font-weight: 500;
            text-decoration: underline dotted;
            text-underline-offset: 3px;
            transition: color 0.15s ease-in-out, text-decoration-color 0.15s ease-in-out;
        }
         .recipe-trigger:hover {
             color: #1d4ed8;
             text-decoration: underline solid;
             text-decoration-color: #1d4ed8;
         }

        /* Stili Navigation Drawer (Invariati) */
        #sideNav {
            position: fixed; top: 0; left: 0; height: 100%; width: 280px;
            background-color: #ffffff;
            box-shadow: 0 8px 10px -5px rgb(0 0 0 / 0.2), 0 16px 24px 2px rgb(0 0 0 / 0.14), 0 6px 30px 5px rgb(0 0 0 / 0.12);
            transform: translateX(-100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 40; padding-top: 1rem; display: flex; flex-direction: column;
        }
        #sideNav.open { transform: translateX(0); }
        #navHeader { padding: 1rem 1.5rem; border-bottom: 1px solid #e5e7eb; margin-bottom: 0.5rem; }
        #navHeader h2 { font-size: 1.125rem; font-weight: 600; color: #1f2937; }
        #navOverlay { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.5); z-index: 30; opacity: 0; transition: opacity 0.3s ease-in-out; pointer-events: none; }
        #navOverlay.active { opacity: 1; pointer-events: auto; }
        #sideNav a { display: flex; align-items: center; padding: 0.875rem 1.5rem; color: #374151; font-weight: 500; border-radius: 0 1.75rem 1.75rem 0; margin-right: 1rem; margin-bottom: 0.25rem; transition: background-color 0.15s ease-in-out, color 0.15s ease-in-out; text-decoration: none; }
        #sideNav a:hover { background-color: #f0f4ff; color: #3730a3; }
        #sideNav a.active { background-color: #e0e7ff; color: #3730a3; font-weight: 600; }
        #sideNav a svg { margin-right: 1rem; width: 20px; height: 20px; flex-shrink: 0; stroke-width: 2; color: #6b7280; transition: color 0.15s ease-in-out; }
        #sideNav a:hover svg, #sideNav a.active svg { color: #3730a3; }

        /* Stili Modal Procedimento (Invariati) */
        #procedureModal { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; z-index: 50; opacity: 0; transition: opacity 0.2s ease-in-out; pointer-events: none; padding: 1rem; }
        #procedureModal.active { opacity: 1; pointer-events: auto; }
        .modal-content { padding: 1.75rem; border-radius: 1rem; box-shadow: 0 24px 38px 3px rgb(0 0 0 / 0.14), 0 9px 46px 8px rgb(0 0 0 / 0.12), 0 11px 15px -7px rgb(0 0 0 / 0.2); max-width: 95%; width: 500px; max-height: 85vh; overflow-y: auto; position: relative; transition: background-color 0.2s ease-in-out, transform 0.2s ease-out; background-color: #ffffff; transform: scale(0.95); }
        #procedureModal.active .modal-content { transform: scale(1); }
        .modal-close-btn { position: absolute; top: 0.75rem; right: 0.75rem; background: none; border: none; cursor: pointer; padding: 0.5rem; line-height: 1; z-index: 10; border-radius: 9999px; transition: background-color 0.15s ease-in-out, transform 0.1s ease-in-out; color: #6b7280; }
        .modal-close-btn:hover { background-color: rgba(0, 0, 0, 0.1); color: #1f2937; transform: scale(1.1); }
        .modal-close-btn:active { transform: scale(1); }
        .modal-close-btn svg { display: block; width: 20px; height: 20px; }
        #modalProcedureText ol { list-style: decimal; margin-left: 1.5rem; }
        #modalProcedureText li { padding-left: 0.5rem; margin-bottom: 0.625rem; line-height: 1.6; }
        #modalProcedureText li::marker { font-weight: 500; color: #4b5563; }

        /* Stili Lista Spesa Interattiva (Leggermente adattati per essere dentro details) */
        .shopping-list-container { /* Contenitore per la lista dentro details */
             padding: 0.5rem 1.25rem 1rem; /* Padding interno per la lista */
        }
        .shopping-list-item {
            display: flex; align-items: center; padding: 0.6rem 0;
            border-bottom: 1px solid #f3f4f6; transition: background-color 0.15s ease-in-out;
            border-radius: 0.5rem; margin: 0 -0.5rem; padding-left: 0.5rem; padding-right: 0.5rem;
        }
        .shopping-list-item:hover { background-color: #f9fafb; }
        .shopping-list-item:last-child { border-bottom: none; }
        .shopping-list-item input[type="checkbox"] { margin-right: 0.875rem; cursor: pointer; width: 1.15em; height: 1.15em; accent-color: #4f46e5; flex-shrink: 0; margin-top: 2px; }
        .shopping-list-item label { transition: all 0.2s ease-in-out; flex-grow: 1; cursor: pointer; color: #374151; }
        .shopping-item-text.line-through { text-decoration: line-through; color: #9ca3af; text-decoration-thickness: 1.5px; text-decoration-color: #d1d5db; }

        /* Header sticky (Invariato) */
        header { border-bottom: 1px solid #e5e7eb; }

        /* Classe per nascondere le viste non attive */
        .hidden-view { display: none; }

         /* Colori (Invariati) */
         .bg-blue-50 { background-color: #eff6ff; } .bg-green-50 { background-color: #f0fdf4; } .bg-yellow-50 { background-color: #fefce8; } .bg-red-50 { background-color: #fef2f2; } .bg-purple-50 { background-color: #faf5ff; } .bg-pink-50 { background-color: #fdf2f8; } .bg-indigo-50 { background-color: #eef2ff; }
         .bg-blue-100 { background-color: #dbeafe; } .text-blue-800 { color: #1e40af; }
         .bg-green-100 { background-color: #dcfce7; } .text-green-800 { color: #166534; }
         .bg-yellow-100 { background-color: #fef9c3; } .text-yellow-800 { color: #854d0e; }
         .bg-purple-100 { background-color: #f3e8ff; } .text-purple-800 { color: #6b21a8; }
         .bg-pink-100 { background-color: #fce7f3; } .text-pink-800 { color: #9d174d; }
         .bg-indigo-100 { background-color: #e0e7ff; } .text-indigo-800 { color: #3730a3; }
         .bg-red-100 { background-color: #fee2e2; } .text-red-800 { color: #991b1b; }
         .bg-gray-100 { background-color: #f3f4f6; } .text-gray-800 { color: #1f2937; } /* Colori per Dispensa */

         /* Stile per il contenitore principale (Invariato) */
         .main-container { max-width: 896px; margin-left: auto; margin-right: auto; padding: 1rem; }
         @media (min-width: 640px) { .main-container { padding: 1.5rem; } }
         @media (min-width: 1024px) { .main-container { padding: 2rem; } }

    </style>
</head>
<body class="bg-gray-100 font-sans">

    <header class="bg-white shadow-sm sticky top-0 z-20">
        <div class="container mx-auto max-w-4xl px-4 h-16 flex items-center">
            <button id="menuBtn" class="p-2 mr-3 rounded-full hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-150">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu h-6 w-6 text-gray-700"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
            </button>
            <h1 class="text-xl font-semibold text-gray-800">Menu Settimanale</h1>
        </div>
    </header>

    <nav id="sideNav">
         <div id="navHeader"><h2>Navigazione</h2></div>
         <a href="#menu" class="nav-link active" data-target="menu-view"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-days"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg> Menu Settimanale</a>
         <a href="#lista-spesa" class="nav-link" data-target="lista-spesa-view"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-cart"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg> Lista della Spesa</a>
    </nav>

    <div id="navOverlay"></div>

    <div class="main-container mt-4">

        <div id="menu-view">
            <section id="menu" class="mb-12">
                <h2 class="text-xl sm:text-2xl font-semibold text-gray-700 mb-6 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-check-2 mr-2 text-indigo-600 h-6 w-6 sm:h-7 sm:w-7"><path d="M21 14V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/><path d="m16 20 2 2 4-4"/></svg>
                    Piani Giornalieri
                </h2>
                <details class="material-card" open>
                    <summary class="material-summary bg-blue-100 text-blue-800">Luned√¨</summary>
                    <div class="p-3 sm:p-4 text-sm sm:text-base"> <ul class="space-y-3"> <li class="meal-item bg-blue-50 rounded-lg"><strong>ü•õ Colazione:</strong> 300ml Latte parzialmente scremato con 90g Biscotti secchi/ai cereali.</li> <li class="meal-item bg-green-50 rounded-lg"> <strong>üçù Pranzo:</strong> 150g Pasta integrale <span class="recipe-trigger" data-title="Procedimento: Pesto Leggero di Rucola" data-procedure="1. Metti nel mixer circa 30g di rucola.|2. Aggiungi 15g di frutta secca (noci o mandorle), 15g di Olio EVO, 1/2 spicchio d'aglio e 1 cucchiaino di succo di limone.|3. Aggiungi sale e pepe.|4. Frulla fino a ottenere una crema omogenea, aggiungendo 1-2 cucchiai d'acqua se necessario.">al pesto leggero di rucola</span> con 150g Petto di pollo grigliato. Contorno abbondante di pomodori e insalata mista. </li> <li class="meal-item bg-yellow-50 rounded-lg"><strong>üçé Spuntino:</strong> 1 Mela + 170g Yogurt greco + 40g Gallette di riso/mais.</li> <li class="meal-item bg-red-50 rounded-lg"> <strong>üêü Cena:</strong> 200g Orata (o Merluzzo) <span class="recipe-trigger" data-title="Procedimento: Cottura all'Acqua Pazza" data-procedure="1. Soffriggi 1 spicchio d'aglio in 1 cucchiaino (5ml) di Olio EVO in una padella capiente.|2. Aggiungi circa 70-80g di pomodorini tagliati a met√† e 1 cucchiaio di prezzemolo tritato.|3. Versa circa 100-150ml d'acqua o brodo vegetale leggero e porta a leggero bollore.|4. Adagia i filetti di pesce (200g), regola di sale e pepe.|5. Copri e cuoci a fuoco basso per 10-15 minuti (a seconda dello spessore) finch√© il pesce √® cotto e opaco.">all'acqua pazza</span>, 300g Patate lesse o al vapore, asparagi al vapore. </li> <li class="meal-item bg-purple-50 rounded-lg"><strong>üåô Spuntino pre nanna:</strong> 150g Fiocchi di latte + 10g Burro d'arachidi + 30g Gallette di riso/mais.</li> </ul> </div> </details>
                 <details class="material-card"> <summary class="material-summary bg-green-100 text-green-800">Marted√¨</summary> <div class="p-3 sm:p-4 text-sm sm:text-base"> <ul class="space-y-3"> <li class="meal-item bg-blue-50 rounded-lg"><strong>ü•õ Colazione:</strong> 300ml Latte p.s. con 90g Biscotti secchi/ai cereali.</li> <li class="meal-item bg-green-50 rounded-lg"> <strong>üçö Pranzo:</strong> 150g <span class="recipe-trigger" data-title="Procedimento: Riso e Lenticchie" data-procedure="1. Prepara un soffritto con circa 40g di cipolla tritata e 1 cucchiaino (5ml) di olio EVO.|2. Aggiungi 150g di lenticchie (gi√† cotte o sciacquate se in scatola).|3. Aggiungi 150g di riso Basmati e tostalo leggermente per un minuto.|4. Copri con brodo vegetale caldo (circa 350-400ml).|5. Porta a cottura (circa 15-18 min) mescolando di tanto in tanto e aggiungendo altro brodo caldo se necessario.|6. Aggiusta di sale e aggiungi 1 rametto di rosmarino tritato a fine cottura.">Riso e Lenticchie.</span> Contorno di carote crude + 100g Ricottine. </li> <li class="meal-item bg-yellow-50 rounded-lg"><strong>ü•ú Spuntino:</strong> 1 Pera + 30g Frutta secca + 40g Gallette di riso/mais.</li> <li class="meal-item bg-red-50 rounded-lg"> <strong>ü¶É Cena:</strong> 200g <span class="recipe-trigger" data-title="Procedimento: Petto di tacchino saltato con funghi" data-procedure="1. Taglia 200g di petto di tacchino a striscioline o cubetti.|2. Affetta circa 80g di cipolla e 150g di funghi champignon.|3. Scalda 1-2 cucchiaini (5-10ml) di olio in una padella antiaderente e fai appassire la cipolla.|4. Aggiungi i funghi e cuoci finch√© l'acqua di vegetazione √® evaporata.|5. Alza la fiamma, aggiungi il tacchino, sale, pepe.|6. Cuoci a fuoco vivace per 5-7 minuti, finch√© il tacchino √® dorato e cotto internamente.">Petto di tacchino saltato con funghi</span> e cipolla, 130g Farro perlato, insalata mista. </li> <li class="meal-item bg-purple-50 rounded-lg"><strong>üåô Spuntino pre nanna:</strong> 1 misurino (30g) Proteine in polvere sciolte in 200ml acqua o Latte + 20g Frutta secca.</li> </ul> </div> </details>
                 <details class="material-card"> <summary class="material-summary bg-yellow-100 text-yellow-800">Mercoled√¨</summary> <div class="p-3 sm:p-4 text-sm sm:text-base"> <ul class="space-y-3"> <li class="meal-item bg-blue-50 rounded-lg"><strong>ü•õ Colazione:</strong> 300ml Latte p.s. con 90g Biscotti secchi/ai cereali.</li> <li class="meal-item bg-green-50 rounded-lg"> <strong>üêî Pranzo:</strong> 180g Petto di pollo <span class="recipe-trigger" data-title="Procedimento: Cottura alla Pizzaiola" data-procedure="1. Infarina leggermente (facoltativo) 180g di petto di pollo.|2. Rosola 1 spicchio d'aglio in 1 cucchiaino (5ml) di olio EVO.|3. Aggiungi il pollo e fallo dorare su entrambi i lati.|4. Aggiungi pomodori pelati spezzettati (circa 200g), 1 cucchiaino di origano secco, 1 cucchiaino di capperi dissalati (se usati), sale e pepe.|5. Copri e cuoci a fuoco basso per circa 15-20 minuti, finch√© il pollo √® tenero e il sugo si √® addensato.">alla pizzaiola.</span> Accompagnare con 100g Pane integrale e verdure grigliate (melanzane/zucchine). </li> <li class="meal-item bg-yellow-50 rounded-lg"><strong>üçì Spuntino:</strong> 1 Banana + 100g Ricottine con Cacao amaro.</li> <li class="meal-item bg-red-50 rounded-lg"> <strong>ü•© Cena:</strong> <span class="recipe-trigger" data-title="Procedimento: Polpette Leggere al Sugo" data-procedure="1. Impasta 180g di macinato magro con 15g di pane grattugiato, 30g di albume, 1 cucchiaio di prezzemolo tritato, sale e pepe.|2. Forma delle polpette non troppo grandi.|3. Prepara un sugo semplice soffriggendo 40g di cipolla tritata (o aglio) in 1 cucchiaino (5ml) di olio, aggiungendo pomodori pelati (circa 250g) e sale.|4. Adagia delicatamente le polpette nel sugo caldo.|5. Copri e cuoci a fuoco basso per almeno 20-25 minuti, girandole a met√† cottura.">Polpette leggere al sugo</span> con 130g Orzo perlato e spinaci saltati con aglio. </li> <li class="meal-item bg-purple-50 rounded-lg"><strong>üåô Spuntino pre nanna:</strong> 170g Yogurt greco + 40g Gallette di riso/mais + Miele (se gradito).</li> </ul> </div> </details>
                 <details class="material-card"> <summary class="material-summary bg-purple-100 text-purple-800">Gioved√¨</summary> <div class="p-3 sm:p-4 text-sm sm:text-base"> <ul class="space-y-3"> <li class="meal-item bg-blue-50 rounded-lg"><strong>ü•õ Colazione:</strong> 300ml Latte p.s. con 90g Biscotti secchi/ai cereali.</li> <li class="meal-item bg-green-50 rounded-lg"> <strong>ü¶ê Pranzo:</strong> 150g Riso integrale <span class="recipe-trigger" data-title="Procedimento: Riso saltato con Gamberetti e Zucchine" data-procedure="1. Cuoci 150g di riso integrale.|2. Pulisci 150g di gamberetti.|3. Taglia una zucchina a julienne o piccoli cubetti.|4. Salta 1 spicchio d'aglio in 1-2 cucchiaini (5-10ml) di olio EVO.|5. Aggiungi i gamberetti e cuoci per 2-3 minuti finch√© cambiano colore.|6. Aggiungi le zucchine, sale, pepe, succo di limone e 1 cucchiaio di prezzemolo tritato.|7. Salta per un altro minuto, le zucchine devono rimanere croccanti.|8. Unisci il riso cotto e manteca bene.">saltato con 150g Gamberetti e zucchine.</span> Contorno di carote crude + 100g Formaggio spalmabile proteico. </li> <li class="meal-item bg-yellow-50 rounded-lg"><strong>üçä Spuntino:</strong> 1 Pera + 170g Yogurt greco + 30g Gallette di riso/mais.</li> <li class="meal-item bg-red-50 rounded-lg"> <strong>üçó Cena:</strong> 200g <span class="recipe-trigger" data-title="Procedimento: Pollo Arrosto con Rosmarino" data-procedure="1. Prendi 200g di pollo (cosce senza pelle o petto).|2. Condiscilo con 1-2 cucchiaini (5-10ml) di Olio EVO, sale, pepe e 1-2 rametti di rosmarino tritato (e/o 1 spicchio d'aglio se gradito).|3. Disponilo su una teglia insieme a 300g di patate tagliate a spicchi e condite.|4. Cuoci in forno preriscaldato a 190-200¬∞C per circa 30-45 minuti (a seconda della dimensione dei pezzi), finch√© il pollo √® cotto e le patate sono tenere e dorate.">Pollo arrosto con rosmarino,</span> 300g Patate al forno, zucchine grigliate. </li> <li class="meal-item bg-purple-50 rounded-lg"><strong>üåô Spuntino pre nanna:</strong> 150g Fiocchi di latte + 30g Frutta secca.</li> </ul> </div> </details>
                 <details class="material-card"> <summary class="material-summary bg-pink-100 text-pink-800">Venerd√¨</summary> <div class="p-3 sm:p-4 text-sm sm:text-base"> <ul class="space-y-3"> <li class="meal-item bg-blue-50 rounded-lg"><strong>ü•õ Colazione:</strong> 300ml Latte p.s. con 90g Biscotti secchi/ai cereali.</li> <li class="meal-item bg-green-50 rounded-lg"> <strong>üç≤ Pranzo:</strong> <span class="recipe-trigger" data-title="Procedimento: Pasta e Lenticchie" data-procedure="1. Prepara un soffritto con circa 30g sedano, 30g carota, 40g cipolla tritati e 1 cucchiaino (5ml) di olio.|2. Aggiungi 150g di lenticchie (gi√† cotte o sciacquate), i pomodori pelati (circa 150g) spezzettati e brodo vegetale fino a coprire.|3. Porta a cottura (o a bollore se lenticchie gi√† cotte).|4. Butta 100g di pasta mista/ditalini direttamente nella pentola.|5. Cuoci insieme finch√© la pasta √® cotta, aggiungendo brodo caldo q.b. per mantenere la zuppa cremosa. Regola di sale e pepe.">Pasta e Lenticchie (100g pasta mista/ditalini).</span> Servire con 50g Pane integrale. </li> <li class="meal-item bg-yellow-50 rounded-lg"><strong>üçä Spuntino:</strong> 1 Banana + 170g Yogurt greco + 30g Gallette di riso/mais.</li> <li class="meal-item bg-red-50 rounded-lg"> <strong>üç≥ Cena:</strong> <span class="recipe-trigger" data-title="Procedimento: Frittata al Forno Spinaci e Ricotta" data-procedure="1. Cuoci (lessa o salta in padella) circa 150-200g di spinaci freschi e strizzali bene.|2. Sbatti 3 uova intere con 100g albumi in una ciotola.|3. Aggiungi gli spinaci tritati grossolanamente, 50g ricotta, sale, pepe e un pizzico di noce moscata (facoltativa).|4. Mescola bene il composto.|5. Versa in una piccola teglia (diametro ~18-20cm) rivestita di carta forno.|6. Cuoci in forno preriscaldato a 180¬∞C per circa 20-25 minuti o finch√© la frittata √® gonfia, soda e leggermente dorata.">Frittata al forno con spinaci e 50g Ricotta.</span> Contorno di insalata mista e 100g Pane integrale. </li> <li class="meal-item bg-purple-50 rounded-lg"><strong>üåô Spuntino pre nanna:</strong> 1 misurino (30g) Proteine in polvere + 10g Burro d'arachidi.</li> </ul> </div> </details>
                 <details class="material-card"> <summary class="material-summary bg-indigo-100 text-indigo-800">Sabato</summary> <div class="p-3 sm:p-4 text-sm sm:text-base"> <ul class="space-y-3"> <li class="meal-item bg-blue-50 rounded-lg"><strong>ü•õ Colazione:</strong> 300ml Latte p.s. con 90g Biscotti secchi/ai cereali.</li> <li class="meal-item bg-green-50 rounded-lg"> <strong>üçï Pranzo:</strong> Pizza Margherita o con verdure (fatta in casa o da asporto). </li> <li class="meal-item bg-yellow-50 rounded-lg"><strong>üçå Spuntino:</strong> 1 Pera + 150g Fiocchi di latte + 30g Gallette di riso/mais.</li> <li class="meal-item bg-red-50 rounded-lg"> <strong>üç£ Cena:</strong> 180g <span class="recipe-trigger" data-title="Procedimento: Salmone Grigliato" data-procedure="1. Scalda bene una griglia o una padella antiaderente.|2. Condisci 180g di filetto di salmone con sale, pepe, succo di limone e 1 cucchiaio di prezzemolo tritato (o aneto).|3. Cuoci sulla griglia calda per 3-5 minuti per lato (a seconda dello spessore e della cottura desiderata), iniziando dal lato della pelle se presente.">Salmone alla griglia,</span> 130g Riso Basmati, spinaci saltati con aglio e Olio EVO. </li> <li class="meal-item bg-purple-50 rounded-lg"><strong>üåô Spuntino pre nanna:</strong> 170g Yogurt greco + 20g Frutta secca.</li> </ul> </div> </details>
                 <details class="material-card"> <summary class="material-summary bg-red-100 text-red-800">Domenica</summary> <div class="p-3 sm:p-4 text-sm sm:text-base"> <ul class="space-y-3"> <li class="meal-item bg-blue-50 rounded-lg"><strong>ü•õ Colazione:</strong> 300ml Latte p.s. con 90g Biscotti secchi/ai cereali.</li> <li class="meal-item bg-green-50 rounded-lg"> <strong>üçù Pranzo:</strong> 150g Pasta integrale <span class="recipe-trigger" data-title="Procedimento: Rag√π Leggero" data-procedure="1. Prepara un soffritto con 30g sedano, 30g carota, 40g cipolla tritati finemente e 1-2 cucchiaini (5-10ml) di olio EVO.|2. Aggiungi 150g di macinato magro (manzo o misto) e fallo rosolare bene sgranandolo.|3. Sfuma con 50ml di vino bianco o rosso (facoltativo) e lascia evaporare.|4. Aggiungi pomodori pelati (circa 300g) o passata, sale, pepe e una foglia d'alloro (facoltativo).|5. Copri e lascia sobbollire a fuoco basso per almeno 30-40 minuti, aggiungendo poca acqua calda o brodo q.b. se si asciuga troppo.">al rag√π leggero.</span> Contorno di insalata. </li> <li class="meal-item bg-yellow-50 rounded-lg"><strong>üçê Spuntino:</strong> 1 Mela + 100g Ricottine + 40g Gallette di riso/mais.</li> <li class="meal-item bg-red-50 rounded-lg"> <strong>üçó Cena:</strong> 200g <span class="recipe-trigger" data-title="Procedimento: Petto di Pollo Arrosto con Erbe" data-procedure="1. Prendi 200g di petto di pollo.|2. Condiscilo massaggiandolo con 1-2 cucchiaini (5-10ml) di Olio EVO, sale, pepe e 1-2 cucchiai di erbe aromatiche tritate (rosmarino, salvia, timo...).|3. Disponilo su una teglia rivestita di carta forno insieme a 300g di patate e melanzane tagliate a pezzi e condite.|4. Cuoci in forno preriscaldato a 190¬∞C per circa 25-30 minuti o finch√© il pollo √® cotto internamente (non secco) e le verdure sono tenere e dorate.">Petto di pollo arrosto con erbe,</span> 300g Patate al forno, melanzane al forno. </li> <li class="meal-item bg-purple-50 rounded-lg"><strong>üåô Spuntino pre nanna:</strong> 1 misurino (30g) Proteine sciolte in 200ml acqua o Latte + 10g Burro d'arachidi.</li> </ul> </div> </details>
            </section>
        </div>

        <div id="lista-spesa-view" class="hidden-view">
            <section id="lista-spesa">
                 <h2 class="text-xl sm:text-2xl font-semibold text-gray-700 mb-6 flex items-center">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-list-checks mr-2 text-teal-600 h-6 w-6 sm:h-7 sm:w-7"><path d="M14 3v4a1 1 0 0 0 1 1h4"/><path d="M17 21h-1a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2.5"/><path d="M10 3H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h4"/><path d="m3 10 2 2 4-4"/><path d="m3 17 2 2 4-4"/></svg>
                     Lista della Spesa Settimanale
                 </h2>
                 <p class="mb-6 text-sm text-gray-600"><strong>Nota:</strong> Clicca sulla casella o sul testo per segnare gli articoli come comprati. Espandi le categorie per vedere gli articoli.</p>

                 <details class="material-card">
                     <summary class="material-summary bg-green-100 text-green-800">
                         <span class="flex items-center"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-carrot category-icon"><path d="M2.27 21.7s9.8-3.5 12.7-12.7C17.5 6.4 18.5 3.5 18.5 3.5c1.5-1.5 3.1-.5 4.1 1 .9 1.5 0 3.1-1.5 4.1 0 0-2.9 1-5.5 3.6-9.2 2.9-12.7 12.7-12.7 12.7Z"/><path d="M18.5 3.5s-4.6 4.6-8.8 8.8"/><path d="M14 10c-2 2-4.5 3.5-4.5 3.5s1.5-2.5 3.5-4.5c2-2 4.5-3.5 4.5-3.5s-1.5 2.5-3.5 4.5Z"/><path d="M22 9s-1.33 1.33-4 4"/></svg>
                            Frutta e Verdura
                         </span>
                     </summary>
                     <div class="shopping-list-container text-sm sm:text-base">
                         <ul class="list-none space-y-1">
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item1" class="shopping-item-checkbox"><label for="sl-item1" class="shopping-item-text">Mele (2)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item2" class="shopping-item-checkbox"><label for="sl-item2" class="shopping-item-text">Pere (2-3)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item3" class="shopping-item-checkbox"><label for="sl-item3" class="shopping-item-text">Banane (2)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item4" class="shopping-item-checkbox"><label for="sl-item4" class="shopping-item-text">Limoni (q.b.)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item5" class="shopping-item-checkbox"><label for="sl-item5" class="shopping-item-text">Rucola (1 busta)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item6" class="shopping-item-checkbox"><label for="sl-item6" class="shopping-item-text">Pomodori (~500g + pomodorini)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item7" class="shopping-item-checkbox"><label for="sl-item7" class="shopping-item-text">Zucchine (3-4)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item8" class="shopping-item-checkbox"><label for="sl-item8" class="shopping-item-text">Asparagi (1 mazzo)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item9" class="shopping-item-checkbox"><label for="sl-item9" class="shopping-item-text">Spinaci freschi (2-3 buste)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item10" class="shopping-item-checkbox"><label for="sl-item10" class="shopping-item-text">Carote (1 mazzo/busta)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item11" class="shopping-item-checkbox"><label for="sl-item11" class="shopping-item-text">Sedano (1 costa)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item12" class="shopping-item-checkbox"><label for="sl-item12" class="shopping-item-text">Insalata mista (1-2 buste)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item13" class="shopping-item-checkbox"><label for="sl-item13" class="shopping-item-text">Patate (~1.5 kg)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item14" class="shopping-item-checkbox"><label for="sl-item14" class="shopping-item-text">Melanzane (2-3)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item15" class="shopping-item-checkbox"><label for="sl-item15" class="shopping-item-text">Aglio (q.b.)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item16" class="shopping-item-checkbox"><label for="sl-item16" class="shopping-item-text">Cipolle (q.b.)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item17" class="shopping-item-checkbox"><label for="sl-item17" class="shopping-item-text">Funghi champignon (~150g)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item18" class="shopping-item-checkbox"><label for="sl-item18" class="shopping-item-text">Prezzemolo fresco (1 mazzetto)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item19" class="shopping-item-checkbox"><label for="sl-item19" class="shopping-item-text">Rosmarino fresco (facoltativo)</label></li>
                         </ul>
                     </div>
                 </details>

                 <details class="material-card">
                     <summary class="material-summary bg-red-100 text-red-800">
                         <span class="flex items-center">
                             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-drumstick category-icon"><path d="M15.44 15.44a1 1 0 0 0 1.41 0L22 10.3V6.7a1 1 0 0 0-.5-.87l-5.17-3a1 1 0 0 0-1 0l-5.17 3a1 1 0 0 0-.5.87v3.6Z"/><path d="M15.44 15.44a1 1 0 0 1-1.41 0L9 10.36V8.5a1 1 0 0 1 .55-.9l3.17-1.8a1 1 0 0 1 1.1 0l3.18 1.8a1 1 0 0 1 .55.9v1.86Z"/><path d="M12.94 12.94a1 1 0 0 0-1.41 1.41l3.17 3.17a5 5 0 1 0 7.08-7.08l-3.17-3.17a1 1 0 0 0-1.41 1.41l.7.7-.7.7-.7-.7-.7.7-.7-.7-.7.7Z"/><path d="M11 11 2.5 2.5"/><path d="m16.5 6.5-11 11"/></svg>
                             Proteine
                         </span>
                     </summary>
                     <div class="shopping-list-container text-sm sm:text-base">
                         <ul class="list-none space-y-1">
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item20" class="shopping-item-checkbox"><label for="sl-item20" class="shopping-item-text">Petto di pollo (~730g)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item21" class="shopping-item-checkbox"><label for="sl-item21" class="shopping-item-text">Cosce di pollo (~200g)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item22" class="shopping-item-checkbox"><label for="sl-item22" class="shopping-item-text">Petto di tacchino (~200g)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item23" class="shopping-item-checkbox"><label for="sl-item23" class="shopping-item-text">Macinato magro Manzo/Misto (~330g)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item24" class="shopping-item-checkbox"><label for="sl-item24" class="shopping-item-text">Salmone (~180g)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item25" class="shopping-item-checkbox"><label for="sl-item25" class="shopping-item-text">Orata/Merluzzo/Pesce bianco (~200g)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item26" class="shopping-item-checkbox"><label for="sl-item26" class="shopping-item-text">Gamberetti (~150g)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item27" class="shopping-item-checkbox"><label for="sl-item27" class="shopping-item-text">Uova (3 + albumi)</label></li>
                         </ul>
                     </div>
                 </details>

                 <details class="material-card">
                     <summary class="material-summary bg-blue-100 text-blue-800">
                          <span class="flex items-center">
                              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-milk category-icon"><path d="M8 2h8"/><path d="M9.5 2v2.5a1.5 1.5 0 0 1-3 0V2"/><path d="M17.5 2v2.5a1.5 1.5 0 0 1-3 0V2"/><path d="M8 8v9a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V8H8Z"/><path d="M8 5h8v2a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1Z"/></svg>
                              Latticini & Frigo
                          </span>
                     </summary>
                     <div class="shopping-list-container text-sm sm:text-base">
                         <ul class="list-none space-y-1">
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item28" class="shopping-item-checkbox"><label for="sl-item28" class="shopping-item-text">Latte p.s. (~2L)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item29" class="shopping-item-checkbox"><label for="sl-item29" class="shopping-item-text">Yogurt greco 0% (~5 vasetti)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item30" class="shopping-item-checkbox"><label for="sl-item30" class="shopping-item-text">Ricottine (~3 vasetti)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item31" class="shopping-item-checkbox"><label for="sl-item31" class="shopping-item-text">Fiocchi di latte (~2 vasetti)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item32" class="shopping-item-checkbox"><label for="sl-item32" class="shopping-item-text">Formaggio spalmabile prot. (1)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item33" class="shopping-item-checkbox"><label for="sl-item33" class="shopping-item-text">Ricotta fresca (~50g)</label></li>
                         </ul>
                     </div>
                 </details>

                 <details class="material-card">
                     <summary class="material-summary bg-yellow-100 text-yellow-800">
                          <span class="flex items-center">
                              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bean category-icon"><path d="M10.165 18.831a4 4 0 0 0 6.7 1.331 1 1 0 0 0-1.768-1.062 2 2 0 0 1-3.382-.653 4 4 0 0 0-3.061-3.06 2 2 0 0 1-.653-3.383A1 1 0 0 0 6.94 10.24a4 4 0 0 0 1.33-6.705 1 1 0 1 0-1.06-1.768A6 6 0 0 0 1.8 12.93a6 6 0 0 0 8.365 5.9z"/><path d="M19.571 4.429a1 1 0 0 0-1.061 1.768 4 4 0 0 1 3.06 3.06 2 2 0 0 0 .652 3.382 1 1 0 0 1 1.06 1.768 4 4 0 0 1-1.33 6.706 1 1 0 0 1 1.768 1.06 6 6 0 0 0 5.9-8.364 6 6 0 0 0-10.05-10.05z"/></svg>
                              Legumi & Conservati
                          </span>
                     </summary>
                     <div class="shopping-list-container text-sm sm:text-base">
                         <ul class="list-none space-y-1">
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item34" class="shopping-item-checkbox"><label for="sl-item34" class="shopping-item-text">Lenticchie secche/in scatola (~300g)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item35" class="shopping-item-checkbox"><label for="sl-item35" class="shopping-item-text">Pomodori pelati/passata (~1kg)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item36" class="shopping-item-checkbox"><label for="sl-item36" class="shopping-item-text">Capperi (vasetto piccolo, fac.)</label></li>
                         </ul>
                     </div>
                 </details>

                 <details class="material-card">
                     <summary class="material-summary bg-gray-100 text-gray-800"> <span class="flex items-center">
                              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-package category-icon"><path d="M16.5 9.4 7.55 4.24"/><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>
                              Dispensa
                          </span>
                     </summary>
                     <div class="shopping-list-container text-sm sm:text-base">
                         <ul class="list-none space-y-1">
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item37" class="shopping-item-checkbox"><label for="sl-item37" class="shopping-item-text">Biscotti secchi/cereali (~630g)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item38" class="shopping-item-checkbox"><label for="sl-item38" class="shopping-item-text">Pasta integrale (~300g)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item39" class="shopping-item-checkbox"><label for="sl-item39" class="shopping-item-text">Pasta mista/Ditalini (~100g)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item40" class="shopping-item-checkbox"><label for="sl-item40" class="shopping-item-text">Pane integrale (~250g)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item41" class="shopping-item-checkbox"><label for="sl-item41" class="shopping-item-text">Gallette di Riso/Mais (~2 pacchi)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item42" class="shopping-item-checkbox"><label for="sl-item42" class="shopping-item-text">Olio Extra Vergine d'Oliva (q.b.)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item43" class="shopping-item-checkbox"><label for="sl-item43" class="shopping-item-text">Proteine in polvere (q.b.)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item44" class="shopping-item-checkbox"><label for="sl-item44" class="shopping-item-text">Burro d'arachidi (q.b.)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item45" class="shopping-item-checkbox"><label for="sl-item45" class="shopping-item-text">Frutta secca (noci/mandorle) (~100g)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item46" class="shopping-item-checkbox"><label for="sl-item46" class="shopping-item-text">Pane grattugiato (q.b.)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item47" class="shopping-item-checkbox"><label for="sl-item47" class="shopping-item-text">Riso Basmati/Integrale (~430g)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item48" class="shopping-item-checkbox"><label for="sl-item48" class="shopping-item-text">Farro/Orzo perlato (~130g + ~130g)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item49" class="shopping-item-checkbox"><label for="sl-item49" class="shopping-item-text">Cacao amaro (q.b.)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item50" class="shopping-item-checkbox"><label for="sl-item50" class="shopping-item-text">Origano (q.b.)</label></li>
                             <li class="shopping-list-item"><input type="checkbox" id="sl-item51" class="shopping-item-checkbox"><label for="sl-item51" class="shopping-item-text">Sale, Pepe, Spezie varie (q.b.)</label></li>
                         </ul>
                     </div>
                 </details>

                 <p class="mt-8 text-xs text-gray-500 italic"><strong>Disclaimer:</strong> Questo √® un piano esemplificativo. Adatta le quantit√† alle tue esigenze e consulta un professionista della nutrizione.</p>
            </section>
        </div>

    </div>

    <div id="procedureModal" class="hidden">
        <div id="modalContentDiv" class="modal-content relative">
            <button id="closeModalBtn" class="modal-close-btn" aria-label="Chiudi modale">
                 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            </button>
            <h3 id="modalTitle" class="text-lg font-semibold mb-4 text-gray-800">Procedimento</h3>
            <div id="modalProcedureText" class="text-sm text-gray-700"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Elementi DOM (Invariati)
            const menuBtn = document.getElementById('menuBtn');
            const sideNav = document.getElementById('sideNav');
            const navOverlay = document.getElementById('navOverlay');
            const navLinks = sideNav.querySelectorAll('a.nav-link');
            const body = document.body;
            const menuView = document.getElementById('menu-view');
            const listaSpesaView = document.getElementById('lista-spesa-view');
            const procedureModal = document.getElementById('procedureModal');
            const modalContentDiv = document.getElementById('modalContentDiv');
            const modalTitle = document.getElementById('modalTitle');
            const modalProcedureText = document.getElementById('modalProcedureText');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const recipeTriggers = document.querySelectorAll('.recipe-trigger');
            // Seleziona gli item della spesa DENTRO la vista corretta per evitare errori
            const shoppingListItems = listaSpesaView.querySelectorAll('.shopping-list-item');

            // Stato iniziale (Invariato)
            menuView.classList.remove('hidden-view');
            listaSpesaView.classList.add('hidden-view');

            // --- Shopping List Logic (Invariata) ---
            shoppingListItems.forEach(item => {
                const checkbox = item.querySelector('.shopping-item-checkbox');
                const label = item.querySelector('.shopping-item-text');

                if (checkbox && label) {
                    const itemId = checkbox.id; // Assicurati che gli ID siano univoci (es. sl-item1, sl-item2...)
                    try {
                        const isChecked = localStorage.getItem(itemId) === 'true';
                        checkbox.checked = isChecked;
                        label.classList.toggle('line-through', isChecked);
                        label.classList.toggle('text-gray-400', isChecked);
                        label.classList.toggle('text-gray-700', !isChecked);
                    } catch (e) { console.error("Failed to access localStorage:", e); }

                    const toggleCheck = () => {
                        const isCheckedNow = checkbox.checked;
                        label.classList.toggle('line-through', isCheckedNow);
                        label.classList.toggle('text-gray-400', isCheckedNow);
                        label.classList.toggle('text-gray-700', !isCheckedNow);
                         try { localStorage.setItem(itemId, isCheckedNow); }
                         catch (e) { console.error("Failed to write to localStorage:", e); }
                    };

                    checkbox.addEventListener('change', toggleCheck);
                    label.addEventListener('click', () => {
                        checkbox.checked = !checkbox.checked;
                        checkbox.dispatchEvent(new Event('change'));
                    });
                }
            });

            // --- Navigation Drawer Logic (Invariata) ---
            function openNav() { sideNav.classList.add('open'); navOverlay.classList.add('active'); body.style.overflow = 'hidden'; }
            function closeNav() { sideNav.classList.remove('open'); navOverlay.classList.remove('active'); body.style.overflow = ''; }
            menuBtn.addEventListener('click', (e) => { e.stopPropagation(); openNav(); });
            navOverlay.addEventListener('click', closeNav);

            // --- View Switching Logic (Invariata) ---
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetViewId = link.dataset.target;
                    menuView.classList.add('hidden-view');
                    listaSpesaView.classList.add('hidden-view');
                    const targetView = document.getElementById(targetViewId);
                    if (targetView) { targetView.classList.remove('hidden-view'); }
                    navLinks.forEach(navLink => navLink.classList.remove('active'));
                    link.classList.add('active');
                    closeNav();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            });

            // --- Modal Logic (Invariata) ---
            function getMealBgClass(element) { const parentLi = element.closest('.meal-item'); if (!parentLi) return 'bg-white'; const bgClass = Array.from(parentLi.classList).find(cls => cls.startsWith('bg-') && cls.endsWith('-50')); if (bgClass) { return bgClass.replace('-50', '-100'); } return 'bg-gray-100'; }
            function removeBgClasses(element) { const classesToRemove = Array.from(element.classList).filter(cls => cls.startsWith('bg-')); element.classList.remove(...classesToRemove); }
            function openModal(title, procedure, bgColorClass) { modalTitle.textContent = title || 'Procedimento'; const steps = procedure ? procedure.split('|') : []; let procedureHtml = '<p class="text-gray-500">Procedimento non specificato.</p>'; if (steps.length > 0 && steps[0].trim() !== '') { procedureHtml = '<ol>'; steps.forEach(step => { procedureHtml += `<li>${step.trim()}</li>`; }); procedureHtml += '</ol>'; } modalProcedureText.innerHTML = procedureHtml; removeBgClasses(modalContentDiv); modalContentDiv.classList.add(bgColorClass || 'bg-white'); procedureModal.classList.remove('hidden'); void procedureModal.offsetWidth; procedureModal.classList.add('active'); body.style.overflow = 'hidden'; }
            function closeModal() { procedureModal.classList.remove('active'); setTimeout(() => { procedureModal.classList.add('hidden'); body.style.overflow = ''; removeBgClasses(modalContentDiv); modalContentDiv.classList.add('bg-white'); }, 200); }
            recipeTriggers.forEach(trigger => { trigger.addEventListener('click', function(event) { event.preventDefault(); const title = this.dataset.title; const procedure = this.dataset.procedure; const bgColorClass = getMealBgClass(this); openModal(title, procedure, bgColorClass); }); });
            closeModalBtn.addEventListener('click', closeModal);
            procedureModal.addEventListener('click', function(event) { if (event.target === procedureModal) { closeModal(); } });
            document.addEventListener('keydown', function(event) { if (event.key === 'Escape' && procedureModal.classList.contains('active')) { closeModal(); } });

        });
    </script>

</body>
</html>
